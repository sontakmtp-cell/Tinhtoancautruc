<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Toán Stiffeners Dầm Hộp - Eurocode 3-1-5</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .input-section {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .input-field {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .results-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container {
            margin-top: 20px;
            height: 400px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
        .note {
            font-style: italic;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tính Toán Stiffeners Cho Dầm Hộp Theo Eurocode 3-1-5</h1>
        
        <div class="input-section">
            <h2>Thông số đầu vào</h2>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="b1">Bề rộng cánh dưới b1 (mm)</label>
                    <input type="number" id="b1" value="400">
                </div>
                <div class="input-field">
                    <label for="t1">Bề dày cánh dưới t1 (mm)</label>
                    <input type="number" id="t1" value="20">
                </div>
                <div class="input-field">
                    <label for="b2">Bề rộng cánh trên b2 (mm)</label>
                    <input type="number" id="b2" value="400">
                </div>
                <div class="input-field">
                    <label for="t2">Bề dày cánh trên t2 (mm)</label>
                    <input type="number" id="t2" value="20">
                </div>
            </div>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="b3">Khoảng cách 2 bụng b3 (mm)</label>
                    <input type="number" id="b3" value="800">
                </div>
                <div class="input-field">
                    <label for="t3">Bề dày bụng t3 (mm)</label>
                    <input type="number" id="t3" value="12">
                </div>
                <div class="input-field">
                    <label for="H">Chiều cao tiết diện H (mm)</label>
                    <input type="number" id="H" value="1200">
                </div>
                <div class="input-field">
                    <label for="L">Nhịp dầm L (mm)</label>
                    <input type="number" id="L" value="10000">
                </div>
            </div>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="V_Ed">Lực cắt thiết kế V_Ed (kN)</label>
                    <input type="number" id="V_Ed" value="800">
                </div>
                <div class="input-field">
                    <label for="M_Ed">Mô men thiết kế M_Ed (kNm)</label>
                    <input type="number" id="M_Ed" value="2500">
                </div>
                <div class="input-field">
                    <label for="E">Mô đun đàn hồi E (MPa)</label>
                    <input type="number" id="E" value="210000">
                </div>
                <div class="input-field">
                    <label for="nu">Hệ số Poisson ν</label>
                    <input type="number" id="nu" value="0.3" step="0.01">
                </div>
            </div>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="f_yw">Giới hạn chảy bụng f_yw (MPa)</label>
                    <input type="number" id="f_yw" value="355">
                </div>
                <div class="input-field">
                    <label for="f_yf">Giới hạn chảy cánh f_yf (MPa)</label>
                    <input type="number" id="f_yf" value="355">
                </div>
                <div class="input-field">
                    <label for="gamma_M0">Hệ số an toàn γ_M0</label>
                    <input type="number" id="gamma_M0" value="1.0" step="0.1">
                </div>
                <div class="input-field">
                    <label for="gamma_M1">Hệ số an toàn γ_M1</label>
                    <input type="number" id="gamma_M1" value="1.1" step="0.1">
                </div>
            </div>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="eta">Hệ số η</label>
                    <input type="number" id="eta" value="1.2" step="0.1">
                </div>
                <div class="input-field">
                    <label for="stiffener_type">Loại sườn</label>
                    <select id="stiffener_type">
                        <option value="intermediate">Sườn trung gian</option>
                        <option value="end">Sườn gối</option>
                    </select>
                </div>
            </div>
            
            <button id="calculateBtn">Tính Toán</button>
            <div id="errorMessage" class="error"></div>
        </div>
        
        <div class="results-section">
            <div class="results-card">
                <h2>Kết quả tính toán</h2>
                <div id="results">
                    <p>Nhấn "Tính Toán" để xem kết quả</p>
                </div>
            </div>
            
            <div class="results-card">
                <h2>Thông số stiffener đề xuất</h2>
                <div id="stiffenerResults">
                    <p>Nhấn "Tính Toán" để xem kết quả</p>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <h2>Biểu đồ phân bố lực cắt và vị trí stiffeners</h2>
            <div id="chart"></div>
        </div>
        
        <div class="note">
            <p>Lưu ý: Ứng dụng này cung cấp kết quả tính toán sơ bộ theo Eurocode 3-1-5. 
            Để đảm bảo an toàn, cần kiểm tra lại bằng các phần mềm chuyên dụng và tham khảo ý kiến kỹ sư kết cấu có chuyên môn.</p>
        </div>
    </div>

    <script>
        document.getElementById('calculateBtn').addEventListener('click', calculate);
        
        function calculate() {
            // Reset error message
            document.getElementById('errorMessage').textContent = '';
            
            // Get input values
            const b1 = parseFloat(document.getElementById('b1').value);
            const t1 = parseFloat(document.getElementById('t1').value);
            const b2 = parseFloat(document.getElementById('b2').value);
            const t2 = parseFloat(document.getElementById('t2').value);
            const b3 = parseFloat(document.getElementById('b3').value);
            const t3 = parseFloat(document.getElementById('t3').value);
            const H = parseFloat(document.getElementById('H').value);
            const L = parseFloat(document.getElementById('L').value);
            const V_Ed = parseFloat(document.getElementById('V_Ed').value);
            const M_Ed = parseFloat(document.getElementById('M_Ed').value);
            const E = parseFloat(document.getElementById('E').value);
            const nu = parseFloat(document.getElementById('nu').value);
            const f_yw = parseFloat(document.getElementById('f_yw').value);
            const f_yf = parseFloat(document.getElementById('f_yf').value);
            const gamma_M0 = parseFloat(document.getElementById('gamma_M0').value);
            const gamma_M1 = parseFloat(document.getElementById('gamma_M1').value);
            const eta = parseFloat(document.getElementById('eta').value);
            const stiffenerType = document.getElementById('stiffener_type').value;
            
            // Validate inputs
            if ([b1, t1, b2, t2, b3, t3, H, L, V_Ed, M_Ed, E, nu, f_yw, f_yf, gamma_M0, gamma_M1, eta].some(isNaN)) {
                document.getElementById('errorMessage').textContent = 'Vui lòng nhập đầy đủ và hợp lệ tất cả các giá trị.';
                return;
            }
            
            // Calculate derived values
            const h_w = H - t1 - t2; // Chiều cao bụng hữu hiệu
            const epsilon = Math.sqrt(235 / f_yw); // Hệ số epsilon
            
            // Kiểm tra điều kiện cần sườn
            const needsStiffeners = h_w / t3 > 4.86 * epsilon;
            
            // Tính toán bước sườn a
            // Đây là phần tính toán phức tạp, ở đây chỉ minh họa đơn giản
            // Trong thực tế cần giải phương trình V_bw,Rd(a) >= V_Ed
            
            // Giả lập tính toán bước sườn a
            let a_optimal = calculateOptimalStiffenerSpacing(h_w, t3, V_Ed, f_yw, E, nu, gamma_M1, eta);
            
            // Tính toán kích thước sườn
            const stiffenerResults = calculateStiffenerDimensions(h_w, t3, a_optimal, stiffenerType, f_yw, E);
            
            // Hiển thị kết quả
            displayResults(h_w, epsilon, needsStiffeners, a_optimal, stiffenerResults);
            
            // Vẽ biểu đồ
            drawChart(L, V_Ed, a_optimal, stiffenerResults);
        }
        
        function calculateOptimalStiffenerSpacing(h_w, t3, V_Ed, f_yw, E, nu, gamma_M1, eta) {
            // Đây là hàm giả lập tính toán bước sườn tối ưu
            // Trong thực tế, cần giải phương trình phức tạp theo Eurocode 3-1-5
            
            // Giá trị tối thiểu và tối đa cho a
            const a_min = 0.5 * h_w;
            const a_max = 2.0 * h_w;
            
            // Tính toán sơ bộ dựa trên lực cắt và kích thước bụng
            // Công thức đơn giản hóa cho mục đích minh họa
            let a_estimated = (h_w * t3 * f_yw) / (Math.sqrt(3) * gamma_M1 * V_Ed) * 1000; // Chuyển đổi đơn vị
            
            // Đảm bảo a nằm trong giới hạn hợp lý
            a_estimated = Math.max(a_min, Math.min(a_max, a_estimated));
            
            // Làm tròn đến giá trị hợp lý (bội số của 50mm)
            a_estimated = Math.round(a_estimated / 50) * 50;
            
            return a_estimated;
        }
        
        function calculateStiffenerDimensions(h_w, t3, a, type, f_yw, E) {
            // Tính toán kích thước sườn dựa trên các thông số
            // Đây là tính toán đơn giản hóa cho mục đích minh họa
            
            let b_s, t_s;
            
            if (type === 'intermediate') {
                // Sườn trung gian
                b_s = Math.max(0.1 * h_w, 80); // Bề rộng tối thiểu
                b_s = Math.round(b_s / 10) * 10; // Làm tròn
                
                t_s = Math.max(0.6 * Math.sqrt(f_yw / 235) * t3, 8); // Chiều dày tối thiểu
                t_s = Math.round(t_s); // Làm tròn
            } else {
                // Sườn gối
                b_s = Math.max(0.15 * h_w, 100); // Bề rộng lớn hơn sườn trung gian
                b_s = Math.round(b_s / 10) * 10;
                
                t_s = Math.max(0.8 * Math.sqrt(f_yw / 235) * t3, 10);
                t_s = Math.round(t_s);
            }
            
            // Tính mô men quán tính yêu cầu (đơn giản hóa)
            const I_req = (b_s * Math.pow(t_s, 3)) / 12;
            
            return {
                width: b_s,
                thickness: t_s,
                momentOfInertia: I_req
            };
        }
        
        function displayResults(h_w, epsilon, needsStiffeners, a_optimal, stiffenerResults) {
            // Hiển thị kết quả tính toán
            const resultsDiv = document.getElementById('results');
            const stiffenerDiv = document.getElementById('stiffenerResults');
            
            resultsDiv.innerHTML = `
                <table>
                    <tr>
                        <th>Thông số</th>
                        <th>Giá trị</th>
                        <th>Đơn vị</th>
                    </tr>
                    <tr>
                        <td>Chiều cao bụng hữu hiệu h<sub>w</sub></td>
                        <td>${h_w.toFixed(1)}</td>
                        <td>mm</td>
                    </tr>
                    <tr>
                        <td>Hệ số ε</td>
                        <td>${epsilon.toFixed(3)}</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Cần sườn tăng cường</td>
                        <td>${needsStiffeners ? 'CÓ' : 'KHÔNG'}</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Bước sườn tối ưu a</td>
                        <td>${a_optimal.toFixed(0)}</td>
                        <td>mm</td>
                    </tr>
                    <tr>
                        <td>Số lượng sườn cần thiết</td>
                        <td>${Math.ceil(10000 / a_optimal)}</td>
                        <td>cái</td>
                    </tr>
                </table>
            `;
            
            stiffenerDiv.innerHTML = `
                <table>
                    <tr>
                        <th>Thông số</th>
                        <th>Giá trị</th>
                        <th>Đơn vị</th>
                    </tr>
                    <tr>
                        <td>Bề rộng sườn b<sub>s</sub></td>
                        <td>${stiffenerResults.width}</td>
                        <td>mm</td>
                    </tr>
                    <tr>
                        <td>Chiều dày sườn t<sub>s</sub></td>
                        <td>${stiffenerResults.thickness}</td>
                        <td>mm</td>
                    </tr>
                    <tr>
                        <td>Mô men quán tính yêu cầu</td>
                        <td>${stiffenerResults.momentOfInertia.toExponential(2)}</td>
                        <td>mm<sup>4</sup></td>
                    </tr>
                </table>
                <p class="note">Lưu ý: Kích thước sườn có thể cần điều chỉnh để phù hợp với tiêu chuẩn thi công và vật liệu có sẵn.</p>
            `;
        }
        
        function drawChart(L, V_Ed, a_optimal, stiffenerResults) {
            // Tạo dữ liệu cho biểu đồ
            const xValues = [];
            const shearValues = [];
            const stiffenerPositions = [];
            
            // Tạo dữ liệu phân bố lực cắt (đơn giản hóa - phân bố tuyến tính)
            for (let x = 0; x <= L; x += L/20) {
                xValues.push(x);
                // Giả sử phân bố lực cắt parabol đơn giản
                shearValues.push(V_Ed * (1 - 4 * Math.pow(x/L - 0.5, 2)));
                
                // Đánh dấu vị trí sườn
                if (x % a_optimal < L/20) {
                    stiffenerPositions.push(x);
                }
            }
            
            // Vẽ biểu đồ
            const shearTrace = {
                x: xValues,
                y: shearValues,
                mode: 'lines',
                name: 'Phân bố lực cắt',
                line: {color: 'blue', width: 2}
            };
            
            const stiffenerTrace = {
                x: stiffenerPositions,
                y: new Array(stiffenerPositions.length).fill(V_Ed * 0.1), // Vị trí đánh dấu
                mode: 'markers',
                name: 'Vị trí sườn',
                marker: {color: 'red', size: 8, symbol: 'triangle-up'}
            };
            
            const layout = {
                title: 'Phân bố lực cắt và vị trí stiffeners',
                xaxis: {title: 'Vị trí dọc dầm (mm)'},
                yaxis: {title: 'Lực cắt (kN)'},
                showlegend: true
            };
            
            Plotly.newPlot('chart', [shearTrace, stiffenerTrace], layout);
        }
    </script>
</body>
</html>